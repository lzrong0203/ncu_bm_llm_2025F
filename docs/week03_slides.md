# Week 3: Prompt Engineering 實作
## 商業文件處理與自動化

---

## 📚 本週學習目標

1. **掌握 Prompt Engineering 核心技巧**
   - Zero-shot、Few-shot、Chain-of-Thought
   - 實際應用於商業場景

2. **學會結構化輸出**
   - JSON、CSV 格式生成
   - 自動化資料處理

3. **建立智慧表單系統**
   - 情感分析、意圖分類
   - 商業流程自動化

---

## 🎯 本週重點：簡化版範例程式

### 為什麼使用簡化版？

- ✅ **無需互動**：直接執行看結果
- ✅ **容易理解**：專注核心概念
- ✅ **課堂友好**：快速展示功能
- ✅ **減少錯誤**：避免輸入問題

### 檔案命名規則
- 所有程式都已簡化為教學版本
- 直接執行即可看到所有範例結果

---

## 📂 本週程式檔案

```bash
week03_prompt_engineering/
├── 01_prompting_basics.py      # Prompt 技巧
├── 02_structured_output.py     # 結構化輸出
├── 03_smart_form_processor.py  # 表單處理
└── 04_openai_agent_basic.py    # API 比較
```

---

## 1️⃣ Prompt Engineering 基礎技巧

### 執行範例
```bash
python week03_prompt_engineering/01_prompting_basics.py
```

### 五大技巧展示

#### 1. Zero-shot（零樣本學習）
```python
prompt = """判斷以下評論的情感（正面/負面/中性）：
評論：這家餐廳的服務很好，但食物普通，價格偏高。
情感："""
```
- **商業應用**：客戶評價分析

#### 2. Few-shot（少樣本學習）
```python
prompt = """日期格式轉換：
輸入：3月15日2024年 → 輸出：2024-03-15
輸入：2024年5月8日 → 輸出："""
```
- **商業應用**：資料標準化

---

## 1️⃣ Prompt Engineering 技巧（續）

#### 3. Chain-of-Thought（思維鏈）
```python
prompt = """解決數學問題，請一步步思考：
問題：小明有45元，買3個蘋果(每個8元)和一瓶水(12元)
讓我們一步步計算：
1. 蘋果總價：
2. 總花費：
3. 剩餘金額："""
```
- **商業應用**：財務計算、決策分析

#### 4. Zero-shot CoT（魔法句子）
```python
prompt = """餐廳有12張桌子，每桌4人。
3個15人團體預約。還能接待多少散客？
Let's think step by step."""
```
- **商業應用**：資源配置問題

#### 5. 技巧比較
- 同一任務用不同技巧
- 比較效果與效率

---

## 2️⃣ 結構化輸出處理

### 執行範例
```bash
python week03_prompt_engineering/02_structured_output.py
```

### 六個實用範例

#### 範例1：JSON 輸出
```python
text = "iPhone 15 Pro 售價 999 美元，配備 A17 Pro 晶片"
# 輸出：
{
  "product": "iPhone 15 Pro",
  "price": 999,
  "features": ["A17 Pro 晶片"]
}
```

#### 範例2：CSV 生成
```python
# 自動生成產品清單
產品名稱, 價格, 庫存量
筆電, 30000, 10
手機, 20000, 25
```

---

## 2️⃣ 結構化輸出（續）

#### 範例3：資訊提取
```python
text = "張三在台北101與Google的李四會面討論AI合作"
# 提取：
{
  "people": ["張三", "李四"],
  "locations": ["台北101"],
  "organizations": ["Google"]
}
```

#### 範例4-6：
- Markdown 表格生成
- 批次情感分析
- 分類模板使用

### 商業價值
- 📊 自動化報表生成
- 📝 訂單處理系統
- 🔍 客戶資料分析

---

## 3️⃣ 智慧表單處理器

### 執行範例
```bash
python week03_prompt_engineering/03_smart_form_processor.py
```

### 六大功能展示

#### 1. 聯絡資訊提取
```python
text = """我是張明華，在台積電擔任資深工程師。
電子郵件：ming.zhang@tsmc.com
手機：0912-345-678"""
# 自動提取所有聯絡資訊
```

#### 2. 情感分析
```python
texts = ["產品很棒！", "普通", "完全是垃圾"]
# 分析每個評論的情感與信心度
```

---

## 3️⃣ 智慧表單處理（續）

#### 3. 客戶意圖分類
```python
"我上週買的產品有問題，要求退貨！"
# 分類：complaint（投訴）
```

#### 4. 訂單資訊提取
```python
"訂單編號 ORD-2024-001234..."
# 自動提取所有訂單欄位
```

#### 5. 優先級判斷
```python
"系統完全當機，所有用戶無法登入！"
# 判斷：urgent（緊急）
```

#### 6. 自動摘要生成
- 一句話摘要
- 要點列表

### 商業應用場景
- 🎯 客服自動分流
- 📋 表單自動處理
- ⚡ 緊急事件識別

---

## 4️⃣ 本地 vs 雲端模型比較

### 執行範例
```bash
python week03_prompt_engineering/04_openai_agent_basic.py
```

### 比較內容

| 特性 | 本地模型（Ollama） | OpenAI API |
|------|-------------------|------------|
| 費用 | 免費 | 按使用計費 |
| 隱私 | 完全私密 | 資料傳到雲端 |
| 速度 | 依硬體而定 | 通常較快 |
| 能力 | 基本到中等 | 較強大 |
| 網路 | 不需要 | 需要穩定連線 |

### 選擇建議
- **開發測試**：使用本地模型
- **生產環境**：考慮 API
- **敏感資料**：必須用本地

---

## 💡 實作技巧

### 1. 提示詞最佳實踐

```python
# ❌ 不好的提示
"分析這段文字"

# ✅ 好的提示
"""分析以下客戶評論：
1. 判斷情感（正面/負面/中性）
2. 提取關鍵問題
3. 建議回應方式

評論：[客戶評論內容]

輸出格式（JSON）：
{
  "sentiment": "",
  "issues": [],
  "suggestion": ""
}"""
```

### 2. 溫度參數調整
- `0.1`：一致性高，適合結構化任務
- `0.5`：平衡創意與一致性
- `0.9`：創意性高，適合文案生成

---

## 🏢 商業案例分析

### 案例1：電商客服自動化

**問題**：每天處理上千筆客戶詢問

**解決方案**：
1. 意圖分類（詢問/投訴/退貨）
2. 優先級判斷（緊急/一般）
3. 自動回覆模板生成

**效果**：
- 回應時間減少 80%
- 客服人力需求減少 60%
- 客戶滿意度提升 25%

### 案例2：財務報表自動化

**應用**：將非結構化資料轉為結構化報表
- CSV、JSON 格式輸出
- 自動計算與驗證
- 摘要與洞察生成

---

## 🎯 課堂練習

### 練習1：建立客戶服務模板

任務：為您的企業設計5個常用提示模板
- 客戶詢問回覆
- 投訴處理
- 產品推薦
- 訂單查詢
- 售後服務

### 練習2：資料處理自動化

任務：處理一批客戶資料
1. 從文字提取聯絡資訊
2. 分類客戶類型
3. 生成 CSV 報表

### 練習3：情感分析儀表板

任務：分析產品評論
- 批次處理評論
- 統計正負面比例
- 找出關鍵問題

---

## 📊 效能優化建議

### 模型選擇指南

| 任務類型 | 建議模型 | 原因 |
|---------|---------|------|
| 簡單分類 | gemma2:2b | 速度快、資源少 |
| 複雜推理 | gemma2:9b-q4 | 效果好、平衡 |
| 創意文案 | llama3.2:3b | 創意性較高 |

### 批次處理技巧

```python
# 單筆處理（慢）
for item in items:
    process(item)

# 批次處理（快）
batch_size = 5
for i in range(0, len(items), batch_size):
    batch = items[i:i+batch_size]
    process_batch(batch)
```

---

## 🚨 常見問題解決

### 問題1：JSON 解析失敗

**解決方案**：
```python
# 加入錯誤處理
try:
    result = json.loads(response)
except:
    # 清理回應文字
    clean_response = response.strip()
    if "```" in clean_response:
        clean_response = clean_response.split("```")[1]
```

### 問題2：回應不穩定

**解決方案**：
- 降低 temperature
- 提供更多範例
- 明確指定格式

### 問題3：處理速度慢

**解決方案**：
- 使用更小的模型
- 減少 max_tokens
- 批次處理請求

---

## 📋 作業：智慧客服系統原型

### 需求說明

建立一個簡單的客服系統，能夠：

1. **接收客戶訊息**
   - 文字輸入
   - 多種類型（詢問、投訴、建議）

2. **智慧處理**
   - 分類意圖
   - 判斷優先級
   - 提取關鍵資訊

3. **自動回應**
   - 生成合適回覆
   - 結構化輸出
   - 紀錄對話

### 評分標準
- 功能完整性 (40%)
- 程式碼品質 (30%)
- 商業價值 (30%)

---

## 🎯 下週預告：專案提案

### Week 4 內容

1. **分組活動**（2-3人一組）

2. **提案準備**
   - 選定商業問題
   - 設計解決方案
   - 技術可行性分析

3. **提案要素**
   - 問題定義（20%）
   - 解決方案（30%）
   - 技術架構（30%）
   - 預期成果（20%）

### 專案範例
- 智慧客服機器人
- 文件自動摘要系統
- 商品推薦引擎
- 財務報表分析工具

---

## 📚 延伸學習資源

### 本週必讀
1. **Prompt Engineering Guide**
   - [OpenAI 官方指南](https://platform.openai.com/docs/guides/prompt-engineering)
   - 最佳實踐範例

2. **結構化輸出技巧**
   - JSON Schema 設計
   - 錯誤處理策略

### 進階閱讀
1. **Chain-of-Thought 論文**
   - Wei et al. (2022)
   - 理解推理過程

2. **ReAct Framework**
   - Reasoning + Acting
   - 下週預習內容

### 實用工具
- [Prompt Perfect](https://promptperfect.jina.ai/)
- [ChatGPT Prompt Generator](https://www.promptpal.net/)

---

## ✅ 本週檢查清單

### 必須完成
- [ ] 執行所有範例程式
- [ ] 理解五種 Prompt 技巧
- [ ] 練習結構化輸出

### 建議完成
- [ ] 嘗試修改範例程式
- [ ] 建立自己的提示模板庫
- [ ] 比較不同模型效果

### 挑戰任務
- [ ] 結合多種技巧
- [ ] 處理真實商業資料
- [ ] 優化處理效能

---

## 💬 討論問題

### 思考題

1. **何時使用 Few-shot vs Zero-shot？**
   - 考慮：資料量、任務複雜度、一致性需求

2. **如何確保輸出格式正確？**
   - 考慮：Schema 定義、錯誤處理、驗證機制

3. **商業應用的隱私考量？**
   - 考慮：資料脫敏、本地處理、合規要求

### 小組討論
- 分享您的商業應用想法
- 討論實作挑戰
- 交流最佳實踐

---

## 🎉 總結

### 本週學到了什麼？

✅ **Prompt Engineering 核心技巧**
- 從 Zero-shot 到 Chain-of-Thought
- 選擇適合的技巧

✅ **結構化資料處理**
- JSON、CSV 輸出
- 資訊提取與分類

✅ **商業應用實作**
- 客服自動化
- 表單處理
- 優先級判斷

### 下週準備
- 思考專案主題
- 組成專案團隊
- 準備提案簡報

---

## 🙏 謝謝大家！


### 記得
- 💾 備份您的程式碼
- 📝 記錄學習筆記
- 🤝 與同學交流討論

**我們下週見！**